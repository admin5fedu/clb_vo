<!DOCTYPE html>
<html>
<head>
<title>Thẻ Học Viên</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
    flex-direction: column;
    /* Zoom to display larger on screen */
    zoom: 1.5;
  }

  /* CSS cho in ấn - đảm bảo không cắt xén và căn nằm ngang trên A5 */
  @media print {
    @page {
      size: A5 landscape; /* Trang A5 nằm ngang */
      margin: 0.5cm; /* Margin nhỏ để có nhiều không gian hơn */
    }
    
    body {
      zoom: 1; /* Reset zoom khi in */
      background-color: #fff;
      margin: 0;
      padding: 0;
      justify-content: flex-start; /* Căn lên đầu trang */
      align-items: flex-start; /* Căn lên đầu trang */
      min-height: auto;
    }
    
    .id-card-container {
      padding: 0;
      box-shadow: none;
      page-break-inside: avoid;
      margin-top: 0; /* Đặt ở đầu trang */
      background-color: transparent;
    }
    
    .action-buttons {
      display: none; /* Ẩn nút khi in */
    }
    
    .id-card {
      box-shadow: none;
      border: 2px solid #000;
      page-break-inside: avoid;
    }
  }

  .id-card-container {
    padding: 20px;
    background-color: #fff;
    border-radius: 15px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  .id-card {
    /* Kích thước thẻ dọc: cao 8.5cm, rộng 5.5cm */
    width: 5.5cm;
    height: 8.5cm;
    border: 1px solid #ccc;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    position: relative;
  }

  .logo-top-left {
    position: absolute;
    top: 5px;
    left: 5px;
    height: 25px;
    width: 25px;
    z-index: 10;
  }

  .logo-top-left img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .photo-section {
    height: 4.2cm; /* Tăng một chút để có không gian cho ảnh */
    display: flex;
    justify-content: center;
    align-items: flex-start; /* Đổi từ flex-end thành flex-start để căn cao */
    padding-top: 5px; /* Đặt = với top của logo để đỉnh ảnh ngang đỉnh logo */
    flex-shrink: 0; /* Không cho co lại */
  }

  .photo-section img {
    /* Kích thước ảnh 3x4 */
    width: 3cm;
    height: 3.8cm; /* Giảm một chút để vừa với container */
    object-fit: cover;
    border: 2px solid white;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .info-container {
    flex: 1; /* Sử dụng flex thay vì flex-grow */
    background-color: #fff;
    color: #333;
    padding: 5px 8px 8px 8px; /* Giảm padding-top từ 10px xuống 5px để tên học viên sát ảnh */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    text-align: center;
    min-height: 4cm;
    overflow: hidden; /* Ngăn nội dung tràn ra ngoài */
  }

  .full-name {
    font-size: 13px;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: 3px; /* Giảm từ 8px xuống 3px để sát với tên võ đường */
    line-height: 1.1;
    overflow-wrap: break-word;
    word-break: break-word;
    flex-shrink: 0;
  }

  .gym-name {
    font-weight: bold;
    text-transform: uppercase;
    font-size: 11px;
    margin-bottom: 10px;
    margin-top: 0; /* Thêm để sát với tên học viên */
    line-height: 1.1;
  }

  .bottom-info-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    width: 100%;
    margin-top: auto;
    padding: 0;
    gap: 8px;
    flex-shrink: 0;
    height: 2.2cm;
  }

  .info-left {
    flex: 1;
    text-align: left;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 3px;
  }

  .info-left p {
    font-size: 10px;
    font-weight: normal; /* Đổi thành normal cho năm sinh và SĐT */
    margin: 0;
    line-height: 1.2;
    overflow-wrap: break-word;
    word-break: break-word;
  }

  .info-left p:last-child {
    font-size: 11px; /* Mã học viên to hơn */
    font-weight: bold; /* Mã học viên vẫn in đậm */
  }

  .qr-code-container {
    flex-shrink: 0;
    width: 2cm;
    height: 2cm;
    display: flex;
    align-items: flex-end;
  }

  .qr-code-container img {
    width: 2cm !important;
    height: 2cm !important;
    object-fit: contain;
    display: block;
  }

  .action-buttons {
    margin-top: 20px;
    display: flex;
    gap: 10px;
  }

  .action-buttons button {
    padding: 10px 15px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  #print-btn {
    background-color: #007bff;
  }

  #download-btn {
    background-color: #28a745;
  }
</style>
</head>
<body>

<div class="id-card-container" id="id-card-content">
  <div class="id-card">
    <!-- Logo công ty ở góc trên bên trái -->
    <div class="logo-top-left">
      <img id="logo-image" src="https://via.placeholder.com/50/fff/000?text=Logo" alt="Logo công ty">
    </div>

    <!-- Phần ảnh của học viên -->
    <div class="photo-section">
      <img id="student-photo" src="https://placehold.co/300x400/cccccc/333333?text=Ảnh+3x4" alt="Ảnh học viên">
    </div>

    <!-- Phần thông tin và mã QR -->
    <div class="info-container">
      <p class="full-name" id="full-name-field">NGUYỄN VĂN AN</p>
      <p class="gym-name" id="gym-field">VÕ ĐƯỜNG THIẾU LÂM</p>
      
      <div class="bottom-info-row">
        <div class="info-left">
          <p id="dob-field">1995</p>
          <p id="phone-field">0912345678</p>
          <p id="student-id-field">HV001234</p>
        </div>
        <div class="qr-code-container">
          <img id="qr-code" src="https://via.placeholder.com/200/fff/000?text=QR" alt="Mã QR">
        </div>
      </div>
    </div>
  </div>
</div>

<div class="action-buttons">
  <button id="print-btn" onclick="window.print()">In PDF</button>
  <button id="download-btn">Tải PDF</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const urlParams = new URLSearchParams(window.location.search);
        
        // Function to get a parameter and decode it
        const getUrlParam = (param) => {
            const value = urlParams.get(param);
            return value ? decodeURIComponent(value) : null;
        };

        // Lấy dữ liệu từ URL và cập nhật nội dung
        const fullName = getUrlParam('fullName');
        if (fullName) {
            document.getElementById('full-name-field').textContent = fullName.toUpperCase();
        }

        const studentId = getUrlParam('studentId');
        if (studentId) {
            document.getElementById('student-id-field').textContent = studentId;
        }

        const dob = getUrlParam('dob');
        if (dob) {
            document.getElementById('dob-field').textContent = dob;
        }

        const phone = getUrlParam('phone');
        if (phone) {
            document.getElementById('phone-field').textContent = phone;
        }

        const gym = getUrlParam('gym');
        if (gym) {
            document.getElementById('gym-field').textContent = gym.toUpperCase();
        }

        const photoUrl = getUrlParam('photo');
        if (photoUrl) {
            document.getElementById('student-photo').src = photoUrl;
        }

        const qrUrl = getUrlParam('qr');
        if (qrUrl) {
            document.getElementById('qr-code').src = qrUrl;
        }

        const logoUrl = getUrlParam('logo');
        if (logoUrl) {
            document.getElementById('logo-image').src = logoUrl;
        }

        // Tải PDF khi nhấn nút với cấu hình tốt hơn
        document.getElementById('download-btn').addEventListener('click', () => {
            const element = document.getElementById('id-card-content');
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5], // Margin trong cm
                filename: 'the_hoc_vien.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 3, // Tăng độ phân giải
                    useCORS: true,
                    letterRendering: true
                },
                jsPDF: { 
                    unit: 'cm', 
                    format: [21, 14.8], // A5 nằm ngang (21cm x 14.8cm)
                    orientation: 'landscape'
                }
            };
            html2pdf().set(opt).from(element).save();
        });
    });
</script>

</body>
</html>
